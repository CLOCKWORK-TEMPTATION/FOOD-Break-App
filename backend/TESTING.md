# ๐ ุฏููู ุงูุงุฎุชุจุงุฑุงุช - BreakApp Backend

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงููุดุฑูุน ูุญุชูู ุนูู ูุฌููุนุฉ ุดุงููุฉ ูู ุงูุงุฎุชุจุงุฑุงุช ูุถูุงู ุฌูุฏุฉ ุงูููุฏ ูููุซูููุฉ ุงููุธุงู. ุงูุงุฎุชุจุงุฑุงุช ููุณูุฉ ุฅูู ุซูุงุซุฉ ุฃููุงุน ุฑุฆูุณูุฉ:

- **Unit Tests** - ุงุฎุชุจุงุฑุงุช ุงููุญุฏุงุช ููุฎุฏูุงุช ูุงูุฏูุงู ุงููููุตูุฉ
- **Integration Tests** - ุงุฎุชุจุงุฑุงุช ุงูุชูุงูู ููู API endpoints
- **E2E Tests** - ุงุฎุชุจุงุฑุงุช ุดุงููุฉ ููุณููุงุฑูููุงุช ุงููุงููุฉ

## ๐ ูููู ุงูุงุฎุชุจุงุฑุงุช

```
backend/src/__tests__/
โโโ unit/                       # Unit Tests
โ   โโโ authService.test.js     # ุงุฎุชุจุงุฑุงุช ุฎุฏูุฉ ุงููุตุงุฏูุฉ
โ   โโโ orderService.test.js    # ุงุฎุชุจุงุฑุงุช ุฎุฏูุฉ ุงูุทูุจุงุช
โ   โโโ nutritionService.test.js # ุงุฎุชุจุงุฑุงุช ุฎุฏูุฉ ุงูุชุบุฐูุฉ
โโโ integration/                # Integration Tests
โ   โโโ auth.routes.test.js     # ุงุฎุชุจุงุฑุงุช API ุงููุตุงุฏูุฉ
โ   โโโ orders.routes.test.js   # ุงุฎุชุจุงุฑุงุช API ุงูุทูุจุงุช
โโโ e2e/                        # End-to-End Tests
โ   โโโ user-journey.e2e.test.js # ุงุฎุชุจุงุฑุงุช ุฑุญูุฉ ุงููุณุชุฎุฏู
โโโ __mocks__/                  # Mocks ูุดุชุฑูุฉ
โโโ server.test.js              # ุงุฎุชุจุงุฑุงุช ุงูุฎุงุฏู ุงูุฃุณุงุณูุฉ
```

## ๐ ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช

### ุชุดุบูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช
```bash
npm test
```

### ุชุดุบูู ุงุฎุชุจุงุฑุงุช ุงููุญุฏุงุช ููุท
```bash
npm run test:unit
```

### ุชุดุบูู ุงุฎุชุจุงุฑุงุช ุงูุชูุงูู ููุท
```bash
npm run test:integration
```

### ุชุดุบูู ุงุฎุชุจุงุฑุงุช E2E ููุท
```bash
npm run test:e2e
```

### ุชุดุบูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุจุงูุชุฑุชูุจ
```bash
npm run test:all
```

### ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช ูุน ุงูุชุบุทูุฉ
```bash
npm run test:coverage
```

### ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช ูุน ุงูุชูุงุตูู
```bash
npm run test:verbose
```

### ูุถุน ุงููุฑุงูุจุฉ (Watch Mode)
```bash
npm run test:watch
```

## ๐ ุชูุฑูุฑ ุงูุชุบุทูุฉ

ุงูุญุฏ ุงูุฃุฏูู ูุชุบุทูุฉ ุงูููุฏ ุงููุทููุจุฉ:
- **Branches:** 70%
- **Functions:** 70%
- **Lines:** 70%
- **Statements:** 70%

ูุนุฑุถ ุชูุฑูุฑ ุงูุชุบุทูุฉ:
```bash
npm run test:coverage
```

ุณูุชู ุฅูุดุงุก ุชูุฑูุฑ HTML ูู ุงููุฌูุฏ `coverage/lcov-report/index.html`.

## ๐งช Unit Tests

### ุงูุฎุฏูุงุช ุงููุฎุชุจุฑุฉ:

#### 1. AuthService (ุฎุฏูุฉ ุงููุตุงุฏูุฉ)
- โ ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ
- โ ุชุณุฌูู ุงูุฏุฎูู
- โ ุงูุญุตูู ุนูู ุจูุงูุงุช ุงููุณุชุฎุฏู
- โ ุชุญุฏูุซ ุงูููู ุงูุดุฎุตู
- โ ุชุบููุฑ ูููุฉ ุงููุฑูุฑ
- โ ุงูุชุญูู ูู ุงูุจูุงูุงุช ูุงูุฃูุงู

**ูุซุงู:**
```bash
npm run test:unit -- authService.test.js
```

#### 2. OrderService (ุฎุฏูุฉ ุงูุทูุจุงุช)
- โ ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
- โ ุฌูุจ ุงูุทูุจุงุช ูุน ุงูุชุตููุฉ ูุงูู Pagination
- โ ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ
- โ ุฅูุบุงุก ุงูุทูุจ
- โ ุญุณุงุจ ุฅุญุตุงุฆูุงุช ุงูุทูุจุงุช

**ูุซุงู:**
```bash
npm run test:unit -- orderService.test.js
```

#### 3. NutritionService (ุฎุฏูุฉ ุงูุชุบุฐูุฉ)
- โ ุชุณุฌูู ุงูุชุบุฐูุฉ ุงูููููุฉ
- โ ุฌูุจ ุณุฌูุงุช ุงูุชุบุฐูุฉ
- โ ุญุณุงุจ ุงูููู ุงูุบุฐุงุฆูุฉ

**ูุซุงู:**
```bash
npm run test:unit -- nutritionService.test.js
```

## ๐ Integration Tests

### API Endpoints ุงููุฎุชุจุฑุฉ:

#### 1. Auth Routes
- **POST /api/v1/auth/register** - ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ
- **POST /api/v1/auth/login** - ุชุณุฌูู ุงูุฏุฎูู
- **GET /api/v1/auth/me** - ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุญุงูู
- **PUT /api/v1/auth/profile** - ุชุญุฏูุซ ุงูููู ุงูุดุฎุตู
- **POST /api/v1/auth/change-password** - ุชุบููุฑ ูููุฉ ุงููุฑูุฑ

**ูุซุงู:**
```bash
npm run test:integration -- auth.routes.test.js
```

#### 2. Orders Routes
- **POST /api/v1/orders** - ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
- **GET /api/v1/orders** - ุฌูุจ ุฌููุน ุงูุทูุจุงุช
- **GET /api/v1/orders/:id** - ุชูุงุตูู ุทูุจ ูุญุฏุฏ
- **PATCH /api/v1/orders/:id/status** - ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ
- **POST /api/v1/orders/:id/cancel** - ุฅูุบุงุก ุงูุทูุจ
- **GET /api/v1/orders/stats/:projectId** - ุฅุญุตุงุฆูุงุช ุงูุทูุจุงุช

**ูุซุงู:**
```bash
npm run test:integration -- orders.routes.test.js
```

## ๐ญ E2E Tests

### ุงูุณููุงุฑูููุงุช ุงููุฎุชุจุฑุฉ:

#### 1. ุฑุญูุฉ ุงููุณุชุฎุฏู ุงููุงููุฉ
1. ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ
2. ุชุณุฌูู ุงูุฏุฎูู
3. ุนุฑุถ ุจูุงูุงุช ุงููุณุชุฎุฏู
4. ุชุญุฏูุซ ุงูููู ุงูุดุฎุตู
5. ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
6. ุนุฑุถ ุชูุงุตูู ุงูุทูุจ
7. ุนุฑุถ ูุงุฆูุฉ ุงูุทูุจุงุช
8. ุฅูุบุงุก ุงูุทูุจ

#### 2. ูุญุงููุฉ ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจู
- ูุญุงููุฉ ุงููุตูู ุจุฏูู ูุตุงุฏูุฉ
- ูุญุงููุฉ ุงููุตูู ุฅูู ููุงุฑุฏ ูุณุชุฎุฏู ุขุฎุฑ

#### 3. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ุฃุฎุทุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุจูุงูุงุช ุบูุฑ ุตุงูุญุฉ
- ูุณุงุฑุงุช ุบูุฑ ููุฌูุฏุฉ

#### 4. ุงูุชุญูู ูู ุงูุฃูุงู
- Security Headers
- CORS Headers
- ุนุฏู ูุดู ุงููุนูููุงุช ุงูุญุณุงุณุฉ

**ูุซุงู:**
```bash
npm run test:e2e -- user-journey.e2e.test.js
```

## ๐๏ธ ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ

- **Jest** - ุฅุทุงุฑ ุงูุงุฎุชุจุงุฑ ุงูุฑุฆูุณู
- **Supertest** - ุงุฎุชุจุงุฑ HTTP requests
- **Prisma Mock** - ูุญุงูุงุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ูุชุงุจุฉ ุงุฎุชุจุงุฑุงุช ุฌุฏูุฏุฉ

### ูููุฐุฌ Unit Test

```javascript
describe('ServiceName', () => {
  let mockPrisma;

  beforeEach(() => {
    // ุฅุนุฏุงุฏ ุงูู mocks
    mockPrisma = {
      model: {
        findUnique: jest.fn(),
        create: jest.fn(),
      }
    };
  });

  it('ูุฌุจ ุฃู ูููู ุจุงูุนูููุฉ ุจูุฌุงุญ', async () => {
    // Arrange - ุฅุนุฏุงุฏ ุงูุจูุงูุงุช ูุงูู mocks
    mockPrisma.model.findUnique.mockResolvedValue({ id: '1' });

    // Act - ุชูููุฐ ุงูุฏุงูุฉ
    const result = await service.doSomething();

    // Assert - ุงูุชุญูู ูู ุงููุชูุฌุฉ
    expect(result).toBeDefined();
    expect(mockPrisma.model.findUnique).toHaveBeenCalled();
  });
});
```

### ูููุฐุฌ Integration Test

```javascript
describe('POST /api/v1/resource', () => {
  it('ูุฌุจ ุฃู ููุดุฆ ุงูููุฑุฏ ุจูุฌุงุญ', async () => {
    const response = await request(app)
      .post('/api/v1/resource')
      .set('Authorization', `Bearer ${token}`)
      .send({ data: 'test' })
      .expect(201);

    expect(response.body.success).toBe(true);
    expect(response.body.data).toHaveProperty('id');
  });
});
```

## โ๏ธ ุฅุนุฏุงุฏุงุช Jest

ููู `jest.config.js`:
```javascript
module.exports = {
  testEnvironment: 'node',
  coveragePathIgnorePatterns: ['/node_modules/'],
  testMatch: ['**/__tests__/**/*.test.js'],
  coverageThreshold: {
    global: {
      branches: 70,
      functions: 70,
      lines: 70,
      statements: 70,
    },
  },
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  testTimeout: 10000,
};
```

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุงุฎุชุจุงุฑุงุช ุชูุดู ุจุณุจุจ timeout

**ุงูุญู:**
```bash
# ุฒูุงุฏุฉ ููุช timeout
jest --testTimeout=30000
```

### ุงููุดููุฉ: Mocks ูุง ุชุนูู ุจุดูู ุตุญูุญ

**ุงูุญู:**
```javascript
// ุชุฃูุฏ ูู ูุณุญ ุงูู mocks ูุจู ูู ุงุฎุชุจุงุฑ
beforeEach(() => {
  jest.clearAllMocks();
});
```

### ุงููุดููุฉ: ุงุฎุชุจุงุฑุงุช E2E ุชุชุฏุงุฎู ูุน ุจุนุถูุง

**ุงูุญู:**
```bash
# ุงุณุชุฎุฏู runInBand ูุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช ุจุงูุชุณูุณู
npm run test:e2e
```

## ๐ ุฃูุถู ุงูููุงุฑุณุงุช

1. **ุงูุชุจ ุงุฎุชุจุงุฑุงุช ูุงุถุญุฉ ููููููุฉ**
   - ุงุณุชุฎุฏู ุฃุณูุงุก ูุตููุฉ ููุงุฎุชุจุงุฑุงุช
   - ุงุชุจุน ููุท AAA (Arrange, Act, Assert)

2. **ุงุฎุชุจุฑ ุงูุญุงูุงุช ุงูุญุฑุฌุฉ**
   - ุงุฎุชุจุฑ ุงูุญุงูุงุช ุงููุงุฌุญุฉ ูุงููุงุดูุฉ
   - ุงุฎุชุจุฑ ุงูุญุฏูุฏ ูุงูููู ุงูุฎุงุตุฉ

3. **ุญุงูุธ ุนูู ุงุณุชููุงููุฉ ุงูุงุฎุชุจุงุฑุงุช**
   - ูู ุงุฎุชุจุงุฑ ูุฌุจ ุฃู ูุนูู ุจุดูู ูุณุชูู
   - ูุง ุชุนุชูุฏ ุนูู ุชุฑุชูุจ ุชูููุฐ ุงูุงุฎุชุจุงุฑุงุช

4. **ุงุณุชุฎุฏู Mocks ุจุญููุฉ**
   - Mock ุงูุงุนุชูุงุฏูุงุช ุงูุฎุงุฑุฌูุฉ ููุท
   - ูุง ุชุฎุชุจุฑ ุงูู mocksุ ุงุฎุชุจุฑ ุงูููุฏ ุงููุนูู

5. **ุญุงูุธ ุนูู ุณุฑุนุฉ ุงูุงุฎุชุจุงุฑุงุช**
   - ุงุณุชุฎุฏู mocks ููุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูู API ุงูุฎุงุฑุฌูุฉ
   - ุชุฌูุจ ุงูุนูููุงุช ุงูุซูููุฉ ุบูุฑ ุงูุถุฑูุฑูุฉ

## ๐ CI/CD Integration

### GitHub Actions

```yaml
name: Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'
      - name: Install dependencies
        run: npm ci
      - name: Run tests
        run: npm run test:all
      - name: Upload coverage
        uses: codecov/codecov-action@v2
```

## ๐ ุงูุฏุนู ูุงููุณุงุนุฏุฉ

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู ูู ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช:

1. ุชุฃูุฏ ูู ุชุซุจูุช ุฌููุน ุงูุชุจุนูุงุช: `npm install`
2. ุชุฃูุฏ ูู ูุฌูุฏ ููู `.env` ูุน ุงููุชุบูุฑุงุช ุงููุทููุจุฉ
3. ุฑุงุฌุน ุงูุณุฌูุงุช (logs) ููุญุตูู ุนูู ุชูุงุตูู ุงูุฎุทุฃ
4. ุชุญูู ูู ุฅุตุฏุงุฑ Node.js (ูุฌุจ ุฃู ูููู 18+)

## ๐ ูุฑุงุฌุน ุฅุถุงููุฉ

- [Jest Documentation](https://jestjs.io/docs/getting-started)
- [Supertest Documentation](https://github.com/visionmedia/supertest)
- [Testing Best Practices](https://github.com/goldbergyoni/javascript-testing-best-practices)

---

**ุขุฎุฑ ุชุญุฏูุซ:** ุฏูุณูุจุฑ 2024
**ุงูุฅุตุฏุงุฑ:** 1.0.0
