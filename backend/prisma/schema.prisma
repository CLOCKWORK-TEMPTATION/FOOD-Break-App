// مخطط قاعدة البيانات العربية الكاملة لتطبيق BreakApp
// BreakApp Arabic Full Stack Database Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// نموذج المستخدم - User Model
model User {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  email             String   @unique
  password          String
  firstName         String   // الاسم الأول
  lastName          String   // اسم العائلة
  phoneNumber       String?  // رقم الهاتف
  role              UserRole @default(REGULAR)
  language          String   @default("ar") // اللغة المفضلة
  isActive          Boolean  @default(true)
  profileImage      String?  // صورة الملف الشخصي
  
  // معلومات إضافية عربية
  arabicName        String?  // الاسم بالعربية
  nationalId        String?  // رقم الهوية
  department        String?  // القسم
  position          String?  // المنصب
  
  // العلاقات
  orders            Order[]
  exceptions        Exception[]
  projects          ProjectMember[]
  notifications     Notification[]
  medicalProfile    MedicalProfile?
  dietaryProfile    DietaryProfile?
  budgets           Budget[]
  emotionLogs       EmotionLog[]
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("users")
}

// أدوار المستخدمين
enum UserRole {
  REGULAR    // عضو عادي
  VIP        // عضو مميز (النجوم)
  ADMIN      // مدير
  PRODUCER   // منتج
}

// نموذج المشروع - Project Model
model Project {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  name              String   // اسم المشروع
  nameArabic        String?  // اسم المشروع بالعربية
  description       String?  // وصف المشروع
  status            ProjectStatus @default(ACTIVE)
  
  // معلومات الموقع
  location          String?  // موقع التصوير
  coordinates       Coordinates? // إحداثيات GPS
  
  // معلومات التصوير
  shootingSchedule  ShootingSchedule?
  orderWindow       OrderWindow?
  
  // QR Code للوصول
  qrCode            String   @unique
  qrCodeExpiry      DateTime?
  
  // الميزانية
  budget            Float?   // ميزانية المشروع
  dailyBudget       Float?   // الميزانية اليومية
  
  // العلاقات
  members           ProjectMember[]
  orders            Order[]
  restaurants       ProjectRestaurant[]
  shootingSchedules ShootingSchedule[]
  scheduleSettings  ScheduleIntegrationSettings?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("projects")
}

enum ProjectStatus {
  ACTIVE      // نشط
  PAUSED      // متوقف مؤقتاً
  COMPLETED   // مكتمل
  CANCELLED   // ملغي
}

// إحداثيات GPS
type Coordinates {
  latitude  Float
  longitude Float
}

// جدول التصوير
type ShootingSchedule {
  startDate     DateTime
  endDate       DateTime
  dailyStart    String   // وقت بداية اليوم
  dailyEnd      String   // وقت نهاية اليوم
  breakTimes    String[] // أوقات الاستراحة
}

// نافذة الطلبات
type OrderWindow {
  duration      Int      // مدة النافذة بالدقائق (افتراضي: 60)
  reminderTimes Int[]    // أوقات التذكير (بالدقائق قبل الإغلاق)
}

// عضوية المشروع
model ProjectMember {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  userId    String @db.ObjectId
  projectId String @db.ObjectId
  role      ProjectRole @default(CREW)
  joinedAt  DateTime @default(now())
  
  user      User    @relation(fields: [userId], references: [id])
  project   Project @relation(fields: [projectId], references: [id])
  
  @@unique([userId, projectId])
  @@map("project_members")
}

enum ProjectRole {
  CREW       // طاقم
  LEAD       // قائد فريق
  MANAGER    // مدير
  PRODUCER   // منتج
}

// نموذج المطعم - Restaurant Model
model Restaurant {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  name            String   // اسم المطعم
  nameArabic      String?  // اسم المطعم بالعربية
  description     String?  // وصف المطعم
  
  // معلومات الاتصال
  phone           String?  // رقم الهاتف
  email           String?  // البريد الإلكتروني
  website         String?  // الموقع الإلكتروني
  
  // العنوان والموقع
  address         String   // العنوان
  coordinates     Coordinates? // إحداثيات GPS
  deliveryRadius  Float?   // نطاق التوصيل (كم)
  
  // معلومات التشغيل
  cuisineType     String[] // نوع المطبخ
  isActive        Boolean  @default(true)
  isPartner       Boolean  @default(false) // مطعم شريك
  
  // أوقات العمل
  workingHours    WorkingHours?
  
  // التقييم والجودة
  rating          Float?   @default(0)
  reviewCount     Int      @default(0)
  hygieneRating   String?  // تقييم النظافة
  lastInspection  DateTime? // آخر تفتيش
  
  // معلومات التوصيل
  deliveryFee     Float?   // رسوم التوصيل
  minimumOrder    Float?   // الحد الأدنى للطلب
  avgDeliveryTime Int?     // متوسط وقت التوصيل (دقيقة)
  
  // العلاقات
  menuItems       MenuItem[]
  orders          Order[]
  projects        ProjectRestaurant[]
  reviews         RestaurantReview[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@map("restaurants")
}

// أوقات العمل
type WorkingHours {
  monday    DayHours?
  tuesday   DayHours?
  wednesday DayHours?
  thursday  DayHours?
  friday    DayHours?
  saturday  DayHours?
  sunday    DayHours?
}

type DayHours {
  open  String  // وقت الفتح
  close String  // وقت الإغلاق
}

// ربط المطعم بالمشروع
model ProjectRestaurant {
  id           String @id @default(auto()) @map("_id") @db.ObjectId
  projectId    String @db.ObjectId
  restaurantId String @db.ObjectId
  menuType     MenuType @default(GEOGRAPHIC)
  isActive     Boolean @default(true)
  
  project      Project    @relation(fields: [projectId], references: [id])
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id])
  
  @@unique([projectId, restaurantId])
  @@map("project_restaurants")
}

enum MenuType {
  CORE        // القائمة الأساسية
  GEOGRAPHIC  // القائمة الجغرافية
  SPECIAL     // القائمة الخاصة
}

// نموذج عنصر القائمة - MenuItem Model
model MenuItem {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  restaurantId    String   @db.ObjectId
  
  // معلومات أساسية
  name            String   // اسم الطبق
  nameArabic      String?  // اسم الطبق بالعربية
  description     String?  // وصف الطبق
  descriptionArabic String? // وصف الطبق بالعربية
  
  // السعر والتوفر
  price           Float    // السعر
  isAvailable     Boolean  @default(true)
  category        String   // الفئة
  
  // الصور
  images          String[] // صور الطبق
  
  // معلومات غذائية
  nutrition       NutritionInfo?
  
  // الحساسية والحمية
  allergens       String[] // مسببات الحساسية
  dietaryTags     String[] // علامات الحمية (حلال، نباتي، إلخ)
  
  // معلومات إضافية
  preparationTime Int?     // وقت التحضير (دقيقة)
  spiceLevel      String?  // مستوى الحرارة
  
  // العلاقات
  restaurant      Restaurant @relation(fields: [restaurantId], references: [id])
  orderItems      OrderItem[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@map("menu_items")
}

// معلومات غذائية
type NutritionInfo {
  calories     Int?    // السعرات الحرارية
  protein      Float?  // البروتين (جرام)
  carbs        Float?  // الكربوهيدرات (جرام)
  fat          Float?  // الدهون (جرام)
  fiber        Float?  // الألياف (جرام)
  sugar        Float?  // السكر (جرام)
  sodium       Float?  // الصوديوم (ملليجرام)
}

// نموذج الطلب - Order Model
model Order {
  id                String      @id @default(auto()) @map("_id") @db.ObjectId
  userId            String      @db.ObjectId
  projectId         String?     @db.ObjectId
  restaurantId      String      @db.ObjectId
  
  // معلومات الطلب
  orderNumber       String      @unique // رقم الطلب
  status            OrderStatus @default(PENDING)
  orderType         OrderType   @default(REGULAR)
  
  // العناصر والأسعار
  items             OrderItem[]
  subtotal          Float       // المجموع الفرعي
  deliveryFee       Float       @default(0)
  tax               Float       @default(0)
  discount          Float       @default(0)
  totalAmount       Float       // المجموع الكلي
  
  // معلومات التوصيل
  deliveryAddress   String?     // عنوان التوصيل
  deliveryCoords    Coordinates? // إحداثيات التوصيل
  estimatedDelivery DateTime?   // وقت التوصيل المتوقع
  actualDelivery    DateTime?   // وقت التوصيل الفعلي
  
  // تتبع GPS للتوصيل
  deliveryTracking  DeliveryTracking?
  
  // ملاحظات
  notes             String?     // ملاحظات العميل
  specialInstructions String?   // تعليمات خاصة
  
  // الدفع
  paymentStatus     PaymentStatus @default(PENDING)
  paymentMethod     String?     // طريقة الدفع
  
  // العلاقات
  user              User        @relation(fields: [userId], references: [id])
  project           Project?    @relation(fields: [projectId], references: [id])
  restaurant        Restaurant  @relation(fields: [restaurantId], references: [id])
  exception         Exception?
  
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  
  @@map("orders")
}

enum OrderStatus {
  PENDING           // في الانتظار
  CONFIRMED         // مؤكد
  PREPARING         // قيد التحضير
  OUT_FOR_DELIVERY  // في الطريق
  DELIVERED         // تم التوصيل
  CANCELLED         // ملغي
  REFUNDED          // مسترد
}

enum OrderType {
  REGULAR    // طلب عادي
  EXCEPTION  // طلب استثناء
  EMERGENCY  // طلب طوارئ
}

enum PaymentStatus {
  PENDING    // في الانتظار
  PAID       // مدفوع
  FAILED     // فشل
  REFUNDED   // مسترد
}

// عنصر الطلب
model OrderItem {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  orderId           String   @db.ObjectId
  menuItemId        String   @db.ObjectId
  
  quantity          Int      // الكمية
  price             Float    // السعر وقت الطلب
  specialInstructions String? // تعليمات خاصة
  
  order             Order    @relation(fields: [orderId], references: [id])
  menuItem          MenuItem @relation(fields: [menuItemId], references: [id])
  
  @@map("order_items")
}

// نموذج الاستثناء - Exception Model
model Exception {
  id              String        @id @default(auto()) @map("_id") @db.ObjectId
  userId          String        @db.ObjectId
  orderId         String        @unique @db.ObjectId
  
  type            ExceptionType // نوع الاستثناء
  reason          String        // سبب الاستثناء
  status          ExceptionStatus @default(PENDING)
  
  // المبالغ المالية
  originalAmount  Float         // المبلغ الأصلي
  exceptionAmount Float         // مبلغ الاستثناء
  userPayment     Float         // ما يدفعه المستخدم
  companyPayment  Float         // ما تدفعه الشركة
  
  // الموافقات
  approvedBy      String?       @db.ObjectId // من وافق
  approvedAt      DateTime?     // وقت الموافقة
  rejectionReason String?       // سبب الرفض
  
  // العلاقات
  user            User          @relation(fields: [userId], references: [id])
  order           Order         @relation(fields: [orderId], references: [id])
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  @@map("exceptions")
}

enum ExceptionType {
  FULL      // استثناء كامل
  LIMITED   // استثناء محدود
  SELF_PAID // مدفوع ذاتياً
}

enum ExceptionStatus {
  PENDING   // في الانتظار
  APPROVED  // موافق عليه
  REJECTED  // مرفوض
}

// نموذج الميزانية - Budget Model
model Budget {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  userId          String   @db.ObjectId
  projectId       String?  @db.ObjectId
  
  // معلومات الميزانية
  name            String   // اسم الميزانية
  type            BudgetType @default(PERSONAL)
  period          BudgetPeriod @default(MONTHLY)
  
  // المبالغ
  totalAmount     Float    // المبلغ الكلي
  usedAmount      Float    @default(0) // المبلغ المستخدم
  remainingAmount Float    // المبلغ المتبقي
  
  // التواريخ
  startDate       DateTime // تاريخ البداية
  endDate         DateTime // تاريخ النهاية
  
  // التنبيهات
  alertThreshold  Float?   // حد التنبيه (نسبة مئوية)
  isAlertEnabled  Boolean  @default(true)
  
  // العلاقات
  user            User     @relation(fields: [userId], references: [id])
  alerts          BudgetAlert[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@map("budgets")
}

enum BudgetType {
  PERSONAL  // شخصية
  PROJECT   // مشروع
  TEAM      // فريق
}

enum BudgetPeriod {
  DAILY     // يومية
  WEEKLY    // أسبوعية
  MONTHLY   // شهرية
  YEARLY    // سنوية
}

// تنبيهات الميزانية
model BudgetAlert {
  id          String      @id @default(auto()) @map("_id") @db.ObjectId
  budgetId    String      @db.ObjectId
  
  type        AlertType   // نوع التنبيه
  threshold   Float       // الحد المحدد
  message     String      // رسالة التنبيه
  isResolved  Boolean     @default(false)
  
  budget      Budget      @relation(fields: [budgetId], references: [id])
  
  createdAt   DateTime    @default(now())
  
  @@map("budget_alerts")
}

enum AlertType {
  WARNING   // تحذير (75%)
  CRITICAL  // حرج (90%)
  EXCEEDED  // تجاوز (100%)
}

// نموذج الإشعار - Notification Model
model Notification {
  id          String           @id @default(auto()) @map("_id") @db.ObjectId
  userId      String           @db.ObjectId
  
  type        NotificationType // نوع الإشعار
  title       String           // عنوان الإشعار
  message     String           // محتوى الإشعار
  
  // معلومات إضافية
  data        Json?            // بيانات إضافية
  actionUrl   String?          // رابط الإجراء
  
  // الحالة
  isRead      Boolean          @default(false)
  isArchived  Boolean          @default(false)
  
  // العلاقات
  user        User             @relation(fields: [userId], references: [id])
  
  createdAt   DateTime         @default(now())
  
  @@map("notifications")
}

enum NotificationType {
  ORDER_UPDATE      // تحديث الطلب
  BUDGET_ALERT      // تنبيه الميزانية
  EXCEPTION_STATUS  // حالة الاستثناء
  REMINDER          // تذكير
  SYSTEM            // نظام
  PROMOTION         // عرض ترويجي
}

// الملف الطبي
model MedicalProfile {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  userId          String   @unique @db.ObjectId
  
  // الحساسية
  allergies       String[] // الحساسية الغذائية
  medications     String[] // الأدوية
  conditions      String[] // الحالات الطبية
  
  // جهات الاتصال الطارئة
  emergencyContact EmergencyContact?
  
  // الموافقات
  dataConsent     Boolean  @default(false)
  shareConsent    Boolean  @default(false)
  
  user            User     @relation(fields: [userId], references: [id])
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@map("medical_profiles")
}

type EmergencyContact {
  name         String  // اسم جهة الاتصال
  relationship String  // العلاقة
  phone        String  // رقم الهاتف
  email        String? // البريد الإلكتروني
}

// الملف الغذائي
model DietaryProfile {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  userId          String   @unique @db.ObjectId
  
  // التفضيلات الغذائية
  dietType        String[] // نوع الحمية (نباتي، كيتو، إلخ)
  preferences     String[] // التفضيلات
  dislikes        String[] // ما لا يحب
  
  // القيود الدينية/الثقافية
  religiousRestrictions String[] // القيود الدينية
  culturalPreferences   String[] // التفضيلات الثقافية
  
  // الأهداف الصحية
  healthGoals     String[] // الأهداف الصحية
  calorieTarget   Int?     // هدف السعرات اليومية
  
  user            User     @relation(fields: [userId], references: [id])
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@map("dietary_profiles")
}

// سجل المشاعر (للذكاء العاطفي)
model EmotionLog {
  id          String      @id @default(auto()) @map("_id") @db.ObjectId
  userId      String      @db.ObjectId
  
  mood        MoodType    // الحالة المزاجية
  energy      Int         // مستوى الطاقة (1-10)
  stress      Int         // مستوى التوتر (1-10)
  
  // السياق
  context     String?     // السياق (عمل، راحة، إلخ)
  notes       String?     // ملاحظات
  
  // التوصيات المقترحة
  suggestions String[]    // التوصيات المقترحة
  
  user        User        @relation(fields: [userId], references: [id])
  
  createdAt   DateTime    @default(now())
  
  @@map("emotion_logs")
}

enum MoodType {
  VERY_HAPPY    // سعيد جداً
  HAPPY         // سعيد
  NEUTRAL       // محايد
  SAD           // حزين
  VERY_SAD      // حزين جداً
  STRESSED      // متوتر
  EXCITED       // متحمس
  TIRED         // متعب
  ANGRY         // غاضب
  CALM          // هادئ
}

// تقييم المطعم
model RestaurantReview {
  id           String     @id @default(auto()) @map("_id") @db.ObjectId
  userId       String     @db.ObjectId
  restaurantId String     @db.ObjectId
  orderId      String?    @db.ObjectId
  
  // التقييم
  rating       Int        // التقييم (1-5)
  foodQuality  Int?       // جودة الطعام (1-5)
  service      Int?       // الخدمة (1-5)
  delivery     Int?       // التوصيل (1-5)
  
  // التعليق
  comment      String?    // التعليق
  images       String[]   // صور
  
  // الحالة
  isVerified   Boolean    @default(false)
  isPublic     Boolean    @default(true)
  
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id])
  
  createdAt    DateTime   @default(now())
  
  @@map("restaurant_reviews")
}

// نموذج تتبع التوصيل - Delivery Tracking Model
model DeliveryTracking {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  orderId           String   @unique @db.ObjectId
  
  // معلومات السائق
  driverName        String?  // اسم السائق
  driverPhone       String?  // رقم هاتف السائق
  vehicleInfo       String?  // معلومات المركبة
  
  // تتبع الموقع
  currentLocation   Coordinates? // الموقع الحالي
  lastLocationUpdate DateTime? // آخر تحديث للموقع
  
  // معلومات الرحلة
  startedAt         DateTime? // وقت بداية الرحلة
  estimatedArrival  DateTime? // وقت الوصول المتوقع
  actualArrival     DateTime? // وقت الوصول الفعلي
  
  // المسار والمسافة
  routeDistance     Float?   // المسافة بالكيلومتر
  routeDuration     Int?     // المدة المتوقعة بالدقائق
  
  // حالة التوصيل
  status            DeliveryStatus @default(PREPARING)
  statusHistory     DeliveryStatusUpdate[]
  
  // ملاحظات التوصيل
  deliveryNotes     String?  // ملاحظات السائق
  deliveryPhoto     String?  // صورة التسليم
  recipientName     String?  // اسم المستلم
  
  // العلاقات
  order             Order    @relation(fields: [orderId], references: [id])
  locationHistory   LocationHistory[]
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("delivery_tracking")
}

// حالات التوصيل
enum DeliveryStatus {
  PREPARING         // قيد التحضير
  DRIVER_ASSIGNED   // تم تعيين السائق
  PICKED_UP         // تم الاستلام من المطعم
  ON_THE_WAY        // في الطريق
  NEARBY            // قريب من الموقع
  DELIVERED         // تم التسليم
  FAILED            // فشل التسليم
  RETURNED          // تم الإرجاع
}

// تحديثات حالة التوصيل
model DeliveryStatusUpdate {
  id                String          @id @default(auto()) @map("_id") @db.ObjectId
  trackingId        String          @db.ObjectId
  
  status            DeliveryStatus  // الحالة الجديدة
  timestamp         DateTime        @default(now()) // وقت التحديث
  location          Coordinates?    // الموقع وقت التحديث
  notes             String?         // ملاحظات إضافية
  
  tracking          DeliveryTracking @relation(fields: [trackingId], references: [id])
  
  @@map("delivery_status_updates")
}

// تاريخ المواقع
model LocationHistory {
  id                String          @id @default(auto()) @map("_id") @db.ObjectId
  trackingId        String          @db.ObjectId
  
  location          Coordinates     // الموقع
  timestamp         DateTime        @default(now()) // وقت التسجيل
  accuracy          Float?          // دقة الموقع بالمتر
  speed             Float?          // السرعة بالكم/ساعة
  heading           Float?          // الاتجاه بالدرجات
  
  tracking          DeliveryTracking @relation(fields: [trackingId], references: [id])
  
  @@map("location_history")
}
  id                    String   @id @default(auto()) @map("_id") @db.ObjectId
  
  // إعدادات عامة
  appName               String   @default("BreakApp")
  appNameArabic         String   @default("بريك آب")
  defaultLanguage       String   @default("ar")
  supportedLanguages    String[] @default(["ar", "en"])
  
  // إعدادات الطلبات
  defaultOrderWindow    Int      @default(60) // دقيقة
  maxOrdersPerDay       Int      @default(3)
  
  // إعدادات الاستثناءات
  regularUserQuota      Int      @default(1)  // مرة كل 3 أسابيع
  quotaPeriodDays       Int      @default(21) // 3 أسابيع
  
  // إعدادات التوصيل
  maxDeliveryRadius     Float    @default(5.0) // كم
  defaultDeliveryFee    Float    @default(10.0)
  
  // إعدادات الميزانية
  defaultBudgetAlert    Float    @default(80.0) // 80%
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  @@map("system_settings")
}

// نموذج تتبع التوصيل - Delivery Tracking Model
model DeliveryTracking {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  orderId           String   @unique @db.ObjectId
  
  // معلومات السائق
  driverName        String?  // اسم السائق
  driverPhone       String?  // رقم هاتف السائق
  vehicleInfo       String?  // معلومات المركبة
  
  // تتبع الموقع
  currentLocation   Coordinates? // الموقع الحالي
  lastLocationUpdate DateTime? // آخر تحديث للموقع
  
  // معلومات الرحلة
  startedAt         DateTime? // وقت بداية الرحلة
  estimatedArrival  DateTime? // وقت الوصول المتوقع
  actualArrival     DateTime? // وقت الوصول الفعلي
  
  // المسار والمسافة
  routeDistance     Float?   // المسافة بالكيلومتر
  routeDuration     Int?     // المدة المتوقعة بالدقائق
  
  // حالة التوصيل
  status            DeliveryStatus @default(PREPARING)
  statusHistory     DeliveryStatusUpdate[]
  
  // ملاحظات التوصيل
  deliveryNotes     String?  // ملاحظات السائق
  deliveryPhoto     String?  // صورة التسليم
  recipientName     String?  // اسم المستلم
  
  // العلاقات
  order             Order    @relation(fields: [orderId], references: [id])
  locationHistory   LocationHistory[]
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("delivery_tracking")
}

// حالات التوصيل
enum DeliveryStatus {
  PREPARING         // قيد التحضير
  DRIVER_ASSIGNED   // تم تعيين السائق
  PICKED_UP         // تم الاستلام من المطعم
  ON_THE_WAY        // في الطريق
  NEARBY            // قريب من الموقع
  DELIVERED         // تم التسليم
  FAILED            // فشل التسليم
  RETURNED          // تم الإرجاع
}

// تحديثات حالة التوصيل
model DeliveryStatusUpdate {
  id                String          @id @default(auto()) @map("_id") @db.ObjectId
  trackingId        String          @db.ObjectId
  
  status            DeliveryStatus  // الحالة الجديدة
  timestamp         DateTime        @default(now()) // وقت التحديث
  location          Coordinates?    // الموقع وقت التحديث
  notes             String?         // ملاحظات إضافية
  
  tracking          DeliveryTracking @relation(fields: [trackingId], references: [id])
  
  @@map("delivery_status_updates")
}

// تاريخ المواقع
model LocationHistory {
  id                String          @id @default(auto()) @map("_id") @db.ObjectId
  trackingId        String          @db.ObjectId
  
  location          Coordinates     // الموقع
  timestamp         DateTime        @default(now()) // وقت التسجيل
  accuracy          Float?          // دقة الموقع بالمتر
  speed             Float?          // السرعة بالكم/ساعة
  heading           Float?          // الاتجاه بالدرجات
  
  tracking          DeliveryTracking @relation(fields: [trackingId], references: [id])
  
  @@map("location_history")
}
// نموذج جدول التصوير - Shooting Schedule Model
model ShootingSchedule {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  projectId         String   @db.ObjectId
  
  // معلومات الجدول
  scheduleName      String   // اسم الجدول
  scheduleDate      DateTime // تاريخ التصوير
  
  // أوقات التصوير
  callTime          String   // وقت الحضور
  wrapTime          String?  // وقت الانتهاء المتوقع
  actualWrapTime    String?  // وقت الانتهاء الفعلي
  
  // فترات الراحة والبريك
  breakSchedules    BreakSchedule[]
  
  // حالة الجدول
  status            ScheduleStatus @default(SCHEDULED)
  
  // معلومات التأخير
  delayMinutes      Int?     // دقائق التأخير
  delayReason       String?  // سبب التأخير
  lastUpdated       DateTime @default(now())
  
  // معلومات الموقع
  location          String?  // موقع التصوير
  coordinates       Coordinates? // إحداثيات الموقع
  
  // ملاحظات
  notes             String?  // ملاحظات الجدول
  weatherConditions String?  // الأحوال الجوية
  
  // العلاقات
  project           Project  @relation(fields: [projectId], references: [id])
  scheduleChanges   ScheduleChange[]
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("shooting_schedules")
}

// حالات الجدول
enum ScheduleStatus {
  SCHEDULED         // مجدول
  IN_PROGRESS       // قيد التنفيذ
  ON_BREAK          // في فترة راحة
  DELAYED           // متأخر
  COMPLETED         // مكتمل
  CANCELLED         // ملغي
  POSTPONED         // مؤجل
}

// جدول فترات البريك
model BreakSchedule {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  scheduleId        String   @db.ObjectId
  
  // معلومات البريك
  breakType         BreakType // نوع البريك
  breakName         String   // اسم البريك (غداء، عشاء، إلخ)
  
  // أوقات البريك
  scheduledStart    String   // الوقت المجدول للبداية
  scheduledEnd      String   // الوقت المجدول للنهاية
  actualStart       String?  // الوقت الفعلي للبداية
  actualEnd         String?  // الوقت الفعلي للنهاية
  
  // معلومات الطلب
  orderWindowStart  String?  // بداية نافذة الطلب
  orderWindowEnd    String?  // نهاية نافذة الطلب
  isOrderWindowOpen Boolean  @default(false)
  
  // حالة البريك
  status            BreakStatus @default(SCHEDULED)
  
  // العلاقات
  schedule          ShootingSchedule @relation(fields: [scheduleId], references: [id])
  orders            Order[] // الطلبات المرتبطة بهذا البريك
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("break_schedules")
}

// أنواع البريك
enum BreakType {
  BREAKFAST         // إفطار
  LUNCH             // غداء
  DINNER            // عشاء
  SNACK             // وجبة خفيفة
  TEA_BREAK         // استراحة شاي
  MEAL_BREAK        // استراحة وجبة
}

// حالات البريك
enum BreakStatus {
  SCHEDULED         // مجدول
  ACTIVE            // نشط (يمكن الطلب)
  IN_PROGRESS       // قيد التنفيذ
  COMPLETED         // مكتمل
  CANCELLED         // ملغي
  DELAYED           // متأخر
}

// تغييرات الجدول
model ScheduleChange {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  scheduleId        String   @db.ObjectId
  
  // معلومات التغيير
  changeType        ChangeType // نوع التغيير
  changeDescription String   // وصف التغيير
  
  // القيم القديمة والجديدة
  oldValue          String?  // القيمة القديمة
  newValue          String?  // القيمة الجديدة
  
  // معلومات التغيير
  changedBy         String?  // من قام بالتغيير
  changeReason      String?  // سبب التغيير
  
  // تأثير التغيير
  affectedOrders    Int      @default(0) // عدد الطلبات المتأثرة
  notificationsSent Int      @default(0) // عدد الإشعارات المرسلة
  
  // العلاقات
  schedule          ShootingSchedule @relation(fields: [scheduleId], references: [id])
  
  createdAt         DateTime @default(now())
  
  @@map("schedule_changes")
}

// أنواع التغييرات
enum ChangeType {
  TIME_DELAY        // تأخير في الوقت
  TIME_ADVANCE      // تقديم في الوقت
  BREAK_ADDED       // إضافة بريك
  BREAK_REMOVED     // حذف بريك
  BREAK_MODIFIED    // تعديل بريك
  LOCATION_CHANGE   // تغيير الموقع
  CANCELLATION      // إلغاء
  POSTPONEMENT      // تأجيل
}

// إعدادات تكامل الجدولة
model ScheduleIntegrationSettings {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  projectId         String   @unique @db.ObjectId
  
  // إعدادات التكامل
  isEnabled         Boolean  @default(true)
  autoUpdateOrders  Boolean  @default(true) // تحديث الطلبات تلقائياً
  autoNotifyChanges Boolean  @default(true) // إشعار التغييرات تلقائياً
  
  // إعدادات نافذة الطلب
  orderWindowDuration Int    @default(60) // مدة نافذة الطلب بالدقائق
  orderWindowBefore   Int    @default(120) // فتح النافذة قبل البريك بـ دقيقة
  
  // إعدادات التنبيهات
  reminderIntervals   Int[]  @default([30, 15, 5]) // تذكيرات قبل إغلاق النافذة
  delayThreshold      Int    @default(15) // حد التأخير للتنبيه (دقائق)
  
  // إعدادات التوصيل
  adjustDeliveryTimes Boolean @default(true) // تعديل أوقات التوصيل
  bufferTime          Int    @default(30) // وقت احتياطي للتوصيل
  
  // العلاقات
  project             Project @relation(fields: [projectId], references: [id])
  
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  @@map("schedule_integration_settings")
}